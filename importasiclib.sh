#!/bin/bash


# parse args
while [ $# -gt 0 ] ; do
  case $1 in 
    -path)
      ASICLIBPATH=$2
      shift;;
    -dest)
      DEST=$2
      shift;;
    -h|*)
      echo "usage : $0 -path /path/to/asiclib/ -dest /destination/path"
      exit 1
      ;;
  esac
  shift
done

ASICLIB="asiclib"
ASICLIBPATH=${ASICLIBPATH:-./srcv/common/asiclib}
PADLIBPATH=${PADLIBPATH:-./srcv/common/padlib}
PAD32KLIBPATH=${PAD32KLIBPATH:-srcv/common/32kosc}
DEST=${DEST:-${HOME}/work/SQN3210_product/importFrom3210}/${ASICLIB}
echo "${ASICLIB} : Copy files"

# Cleanup Dest folder
rm -Rf ${DEST}
mkdir -p ${DEST}

# Copy cells
cp -r --parents ${ASICLIBPATH} ${DEST}
pushd ${DEST}/${ASICLIBPATH} > /dev/null
sed "s@ASIC/@ASIC/${ASICLIB}/@" file_list -i
chmod -x *
popd > /dev/null

# Copy pads
cp -r --parents ${PADLIBPATH} ${DEST}
pushd ${DEST}/${PADLIBPATH} > /dev/null
sed "s@ASIC/@ASIC/${ASICLIB}/@" file_list -i
chmod -x *
popd > /dev/null

# 32K pads
cp -r --parents ${PAD32KLIBPATH} ${DEST}
pushd ${DEST}/${PAD32KLIBPATH} > /dev/null
sed "s@ASIC/@ASIC/${ASICLIB}/@" file_list -i
chmod -x *
popd > /dev/null


# Deals with memories
MEMORYPATH=${MEMORYPATH:-./memories}
# copy common stuff
cp --parents ${MEMORYPATH}/Verilog/std_cells.v ${DEST}

# copy memories
# get list of memories from irun log :
# cat irun.log | grep "*E" | sed "s/.*design unit '\(\w\+\)'\s\+.*/\1/"
SCS_MEAS_MEMORIES="RF1R1W_D128_W46
RA1RW_D1024_W32_BE_PG
RA1RW_D16384_W41_RE
RA1RW_D12800_W41_RE
RF1RW_D512_W32_BE
RA1RW_D8192_W24_RE
RA1RW_D2816_W24
RF1R1W_D220_W108
RF1R1W_D220_W96
RA1RW_D640_W8_PG
RA1RW_D1632_W48_RE
RA1RW_D1632_W12_PG
RA1RW_D8192_W32_BE_RE_PG
RA1RW_D16384_W32_BE_RE_PG
RA1RW_D4096_W32_BE_RE_PG
RF1RW_D48_W41
RF1RW_D192_W68
RF1RW_D128_W24
RF1RW_D16_W64
RF1RW_D16_W122"

ULP_MEMORIES="RF1R1W_D20_W92
RF1R1W_D64_W120
RF1R1W_D128_W90
RF1R1W_D512_W90
RA1RW_D768_W8
RF1RW_D96_W8
RF1RW_D200_W96_BE
RA1RW_D1344_W72_RE
RA1RW_D1312_W24
RA1RW_D2048_W24
RF1RW_D64_W24"

MIPS_CLIENT_MEMORIES="RA1RW_D512_W140_BE
RF1RW_D128_W10_BE
RF1RW_D128_W8_BE
RF1RW_D128_W92_BE
RF1RW_D512_W128_BE"

MIPS_CPU_MEMORIES="RA1RW_D1024_W140_BE_RE
RF1RW_D1024_W128_BE_RE
RF1RW_D256_W10_BE
RF1RW_D256_W8_BE
RF1RW_D256_W92_BE"

MAC_TDC_MEMORIES="RF1R1W_D16_W32
RF1R1W_D192_W144
RF1R1W_D192_W32
RA1RW_D16384_W32_BE_RE_PG
RA1RW_D8192_W32_BE_RE_PG
RA1RW_D16384_W32_BE_RE
RF1RW_D192_W64_BE
RF1RW_D72_W144
RF1RW_D72_W128
RF1RW_D192_W32
RA1RW_D768_W8"

DOWNLINK_MEMORIES="RF1R1W_D512_W120
RA1RW_D1344_W48_BE
RA1RW_D1536_W32_BE_PG
RA1RW_D2048_W56_RE
RA1RW_D2304_W18
RA1RW_D4096_W32_BE_RE_PG
RA1RW_D4096_W48_RE
RA1RW_D800_W72
RF1RW_D256_W8
RF1RW_D288_W72"

LTE_TOP_DSPROC_MEMORIES="RF1R1W_D16_W64
RA1RW_D1024_W32_BE_PG
RA1RW_D2048_W32_BE_PG
RA1RW_D3584_W48_RE_PG
RA1RW_D4096_W32_BE_RE
RA1RW_D4096_W32_BE_RE_PG
RF1R1W_D24_W48
RF1R1W_D32_W48
RF1RW_D16_W168
RF1RW_D16_W182"

DIGRF_MEMORIES="RF1R1W_D512_W32
RA2RW_D2048_W8"

SHIVA_TOP_MEMORIES="RA2RW_D2048_W8
RF1R1W_D16_W32
RF1R1W_D32_W32
RF1R1W_D48_W16
RF1R1W_D64_W52
RF1R1W_D784_W32_BE
RF1R1W_D800_W32_BE
RA2RW_D1024_W32
RF1R1W_D64_W32
RF1R1W_D64_W96
RF1RW_D16_W26"

MEMORIES="${SCS_MEAS_MEMORIES} ${ULP_MEMORIES} ${MIPS_CLIENT_MEMORIES} ${MIPS_CPU_MEMORIES} ${MAC_TDC_MEMORIES} ${DOWNLINK_MEMORIES} ${LTE_TOP_DSPROC_MEMORIES} ${DIGRF_MEMORIES} ${SHIVA_TOP_MEMORIES}"
for m in ${MEMORIES}; do
  find  ${MEMORYPATH} -name "*${m}*" -exec cp --parents {} ${DEST} \;
done


